function initValidate(){var n=$.data($("#frmEdit").get(0),"validator").settings;n.messages={Title:{required:"Vui lòng nhập tiêu đề"},Teaser:{required:"Vui lòng nhập tóm tắt"}};n.highlight=function(n){$(n).addClass("is-invalid")};n.unhighlight=function(n){$(n).removeClass("is-invalid");$(n).addClass("is-valid")}}function GetTypeWeb(n,t){var i=t.split("/");return i[2]=="www.yan.vn"||i[2]=="yan.vn"?"yan":i[2]=="www.youtube.com"||i[2]=="youtube.com"?"youtube":i[2]=="www.bestie.vn"||i[2]=="bestie.vn"?"bestie":i[2]=="www.dienanh.net"||i[2]=="dienanh.net"?"dienanh":i[2]=="www.tiin.vn"||i[2]=="tiin.vn"?"tiin":i[2]=="www.kenh14.vn"||i[2]=="kenh14.vn"?"kenh14":void 0}function AutoFill(){var n=$("#UrlRequest").val(),i=$("#TypeCrawling").val(),t;if(n==undefined||n=="")return alert("Bạn vui lòng nhập Url bài viết"),!1;t=GetTypeWeb(i,n);$.ajax({url:`/admincp/content/autofilter?url=${n}&whichWeb=${t}`,type:"GET",success:function(t){var i;console.log(t);t.Status==!0&&($("#Title").val(t.Tbl.Title),$("#Teaser").val(t.Tbl.Teaser),$("#UrlSource").val(n),$("#editor").html(""),editor.setData(""),InsertHTML(t.Tbl.Body),t.Tbl.Avatar2x1!=null&&t.Tbl.Avatar2x1!=undefined?(i='<img src="'+t.Tbl.Avatar2x1+'" class="img-content" />&nbsp;',$("#loadImgThumbnail").html(i),$("#Avatar2x1").val(t.Tbl.Avatar2x1),getDimension(t.Tbl.Avatar2x1,(n,t)=>{$("#AvatarWidth").val(t.naturalWidth),$("#AvatarHeight").val(t.naturalHeight)})):(alert("Bài viết không có hình Avatar, bạn vui lòng chọn từ máy tính"),$("#UploadAvatar").click()),t.Tbl.AvatarFB!=null&&t.Tbl.AvatarFB!=undefined&&(i='<img src="'+t.Tbl.AvatarFB+'" class="img-content" />&nbsp;',$("#loadImgThumbnailFB").html(i),$("#AvatarFB").val(t.Tbl.AvatarFB)))}})}function initValidateUrl(){var n=$.data($("#frmUrl").get(0),"validator").settings;n.messages={urlImage:{required:"Vui lòng nhập link hình"}}}function checkImage(n){var r,t,i;return n?!0:(t=$("#AvatarFB").val(),i=$("#Avatar2x1").val(),t==""?$("#error-AvatarFB").html("Vui lòng upload hình facebook"):$("#error-AvatarFB").html(""),i==""?$("#error-Avatar").html("Vui lòng upload hình cover"):($("#error-Avatar").html(""),r=checkDimension(n)),t!=""&&i!=""&&r?!0:!1)}function checkDimension(n){if(n)return!0;var t=$("#AvatarWidth").val(),i=$("#AvatarHeight").val();return t=="480"&&i=="480"?!0:(alert("Bạn vui lòng chọn hình có kích thước 480x480"),!1)}function savecontent(n,t){var o,s,i;if(t){var r=new Date,u=`${r.getDate()}-${r.getMonth()+1}-${r.getFullYear()} ${r.getHours()}:${r.getMinutes()}:${r.getSeconds()}`,f=$("#Title").val(),e=$("#Teaser").val();(f==undefined||f=="")&&$("#Title").val(`Tiêu đề: ${u}`);(e==undefined||e=="")&&$("#Teaser").val(`Tóm tắt: ${u}`)}o=$("#frmEdit").valid();s=checkImage(t);o&&s&&($("#Body").val(editor.getData()),i=$("#frmEdit").serializeArray(),t!=null?i.push({name:"intstatus",value:-1}):i.push({name:"intstatus",value:$("#cbStatus").val()}),i.push({name:"intstatus",value:$("#cbStatus").val()}),i.push({name:"intFlag",value:n}),i.push({name:"tags",value:$("#MasterTag").val()}),i.push({name:"dtPublic",value:$("#PublishDate").data("daterangepicker").startDate.format("YYYY/MM/DD HH:mm")}),$.ajax({url:"/admincp/content/savenews",type:"POST",data:i,success:function(){window.location.href=document.referrer},error:function(){}}))}function SaveUrl(){if($("#frmUrl").valid()){var i=parseInt($("#IdTypeImage").val()),n=$("#urlImage").val(),t='<img src="'+n+'" class="img-content" />&nbsp;';switch(i){case 1:InsertHTML(t);break;case 2:$("#loadImgThumbnail").html(t);$("#Avatar2x1").val(n);getDimension(n,(n,t)=>{$("#AvatarWidth").val(t.naturalWidth),$("#AvatarHeight").val(t.naturalHeight)});break;case 3:$("#loadImgThumbnailFB").html(t);$("#AvatarFB").val(n)}$("#frmdlg").modal("hide")}}function UploadAvatar(n){var i=!0,t=n.target.files[0],r;/\.(jpg|png)$/i.test(t.name)||(confirm("Bạn vui lòng chọn file png hoặc jpg"),i=!1);t.size>3e6&&(confirm("Bạn vui lòng chọn file hình có kích thước bé hơn 3MB"),i=!1);i==!0&&(r=new FormData,r.append(t.name,t),$.ajax({type:"POST",url:"/admincp/uploads/SaveImageContent",contentType:!1,processData:!1,data:r,success:function(n){if(n.status==!0){var t=window.location.origin+"/uploads/"+n.fileName;$("#loadImgThumbnail").html(`<img src="${t}" class="img-content" />&nbsp;`);$("#Avatar2x1").val(n.fileName)}}}))}function InsertHTML(n){const t=editor.data.processor.toView(n),i=editor.data.toModel(t);editor.model.insertContent(i)}const getDimension=(n,t)=>{const i=new Image;i.onload=()=>t(null,i);i.onerror=n=>t(n);i.src=n};$(function(){$("#errAvatar").css("display","none");$("#errAvatarFB").css("display","none");$("#errMasterTag").css("display","none")});DecoupledDocumentEditor.create(document.querySelector("#editor"),{mediaEmbed:{previewsInData:!0},toolbar:{items:["heading","|","fontSize","fontFamily","|","bold","italic","underline","strikethrough","highlight","|","alignment","|","numberedList","bulletedList","|","indent","outdent","|","todoList","link","blockQuote","imageUpload","insertTable","mediaEmbed","|","undo","redo"]},image:{toolbar:["imageTextAlternative","imageStyle:full","imageStyle:side"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}}).then(n=>{window.editor=n,document.querySelector(".document-editor__toolbar").appendChild(n.ui.view.toolbar.element),document.querySelector(".ck-toolbar").classList.add("ck-reset_all")}).catch(()=>{});