!function(n){"use strict";var t=function(t,i){this.$element=n(t);this.options=n.extend({},n.fn.typeahead.defaults,i);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.source=this.options.source;this.$menu=n(this.options.menu);this.shown=!1;this.listen()},i;t.prototype={constructor:t,select:function(){var n=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(n)).change(),this.hide()},updater:function(n){return n},show:function(){var t=n.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:t.top+t.height,left:t.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var t;return(this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength)?this.shown?this.hide():this:(t=n.isFunction(this.source)?this.source(this.query,n.proxy(this.process,this)):this.source,t?this.process(t):this)},process:function(t){var i=this;return(t=n.grep(t,function(n){return i.matcher(n)}),!t.length)?this.shown?this.hide():this:this.render(t.slice(0,this.options.items)).show()},matcher:function(n){return~n.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(n){for(var i=[],r=[],u=[],t;t=n.shift();)t.toLowerCase().indexOf(this.query.toLowerCase())?~t.indexOf(this.query)?r.push(t):u.push(t):i.push(t);return i.concat(r,u)},highlighter:function(n){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return n.replace(new RegExp("("+t+")","ig"),function(n,t){return"<strong>"+t+"<\/strong>"})},render:function(t){var i=this;return t=n(t).map(function(t,r){return t=n(i.options.item).attr("data-value",r),t.find("a").html(i.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(){var i=this.$menu.find(".active").removeClass("active"),t=i.next();t.length||(t=n(this.$menu.find("li")[0]));t.addClass("active")},prev:function(){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last());n.addClass("active")},listen:function(){this.$element.on("focus",n.proxy(this.focus,this)).on("blur",n.proxy(this.blur,this)).on("keypress",n.proxy(this.keypress,this)).on("keyup",n.proxy(this.keyup,this));if(this.eventSupported("keydown"))this.$element.on("keydown",n.proxy(this.keydown,this));this.$menu.on("click",n.proxy(this.click,this)).on("mouseenter","li",n.proxy(this.mouseenter,this)).on("mouseleave","li",n.proxy(this.mouseleave,this))},eventSupported:function(n){var t=n in this.$element;return t||(this.$element.setAttribute(n,"return;"),t=typeof this.$element[n]=="function"),t},move:function(n){if(this.shown){switch(n.keyCode){case 9:case 13:case 27:n.preventDefault();break;case 38:n.preventDefault();this.prev();break;case 40:n.preventDefault();this.next()}n.stopPropagation()}},keydown:function(t){this.suppressKeyPressRepeat=~n.inArray(t.keyCode,[40,38,9,13,27]);this.move(t)},keypress:function(n){this.suppressKeyPressRepeat||this.move(n)},keyup:function(n){switch(n.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}n.stopPropagation();n.preventDefault()},focus:function(){this.focused=!0},blur:function(){this.focused=!1;!this.mousedover&&this.shown&&this.hide()},click:function(n){n.stopPropagation();n.preventDefault();this.select();this.$element.focus()},mouseenter:function(t){this.mousedover=!0;this.$menu.find(".active").removeClass("active");n(t.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=!1;!this.focused&&this.shown&&this.hide()}};i=n.fn.typeahead;n.fn.typeahead=function(i){return this.each(function(){var u=n(this),r=u.data("typeahead"),f=typeof i=="object"&&i;r||u.data("typeahead",r=new t(this,f));typeof i=="string"&&r[i]()})};n.fn.typeahead.defaults={source:[],items:100,menu:'<ul class="typeahead dropdown-menu"><\/ul>',item:'<li><a href="#"><\/a><\/li>',minLength:1};n.fn.typeahead.Constructor=t;n.fn.typeahead.noConflict=function(){return n.fn.typeahead=i,this};n(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(){var t=n(this);t.data("typeahead")||t.typeahead(t.data())})}(window.jQuery),function(n){"use strict";function i(t,i){this.itemsArray=[];this.$element=n(t);this.$element.hide();this.nameForInputTag=i&&i.nameForInputTag;this.isSelect=t.tagName==="SELECT";this.multiple=this.isSelect&&t.hasAttribute("multiple");this.objectItems=i&&i.itemValue;this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=n('<div class="bootstrap-tagsinput"><\/div>');this.$input=n('<input size="'+this.inputSize+'" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.after(this.$container);this.build(i)}function r(n,t){if(typeof n[t]!="function"){var i=n[t];n[t]=function(n){return n[i]}}}function o(n,t){if(typeof n[t]!="function"){var i=n[t];n[t]=function(){return i}}}function t(n){return n?e.text(n).html():""}function u(n){var t=0,i;return document.selection?(n.focus(),i=document.selection.createRange(),i.moveStart("character",-n.value.length),t=i.text.length):(n.selectionStart||n.selectionStart=="0")&&(t=n.selectionStart),t}var f={tagClass:function(){return"label label-info"},itemValue:function(n){return n?n.toString():n},itemText:function(n){return this.itemValue(n)},nameForInputTag:"",freeInput:!0,maxTags:undefined,confirmKeys:[13],onTagExists:function(n,t){t.hide().fadeIn()}},e;i.prototype={constructor:i,add:function(i,r){var u=this,o,s,e,h,v,c,l;if((!u.options.maxTags||!(u.itemsArray.length>=u.options.maxTags))&&(i===!1||i)){if(typeof i=="object"&&!u.objectItems)throw"Can't add objects when itemValue option is not set";if(!i.toString().match(/^\s*$/)){if(u.isSelect&&!u.multiple&&u.itemsArray.length>0&&u.remove(u.itemsArray[0]),typeof i=="string"&&this.$element[0].tagName==="INPUT"&&(o=i.split(","),o.length>1)){for(s=0;s<o.length;s++)this.add(o[s],!0);r||u.pushVal();return}var f=u.options.itemValue(i),a=u.options.itemText(i),y=u.options.tagClass(i);if(f.toString()!="-1"){if(e=n.grep(u.itemsArray,function(n){return u.options.itemValue(n)===f})[0],e){if(u.options.onTagExists){h=n(".tag",u.$container).filter(function(){return n(this).data("item")===e});u.options.onTagExists(i,h)}return}}else if(e=n.grep(u.itemsArray,function(n){return u.options.itemText(n)===a})[0],console.log("existing:"+e),e){if(u.options.onTagExists){h=n(".tag",u.$container).filter(function(){return n(this).data("item")===e});u.options.onTagExists(i,h)}return}u.itemsArray.push(i);v={};v=f.toString()=="-1"?{id:f.toString(),text:t(a)}:{id:f.toString(),text:f.toString()};c=n('<span class="tag '+t(y)+'">'+t(a)+'<span data-role="remove"><\/span>'+(this.nameForInputTag!=""?'<input type="hidden" name="'+this.nameForInputTag+'" value="'+v.text+'" />':"")+"<\/span>");c.data("item",i);u.findInputWrapper().before(c);c.after(" ");u.isSelect&&!n('option[value="'+escape(f)+'"]',u.$element)[0]&&(l=n("<option selected>"+t(a)+"<\/option>"),l.data("item",i),l.attr("value",f),u.$element.append(l));r||u.pushVal();u.options.maxTags===u.itemsArray.length&&u.$container.addClass("bootstrap-tagsinput-max");u.$element.trigger(n.Event("itemAdded",{item:i}))}}},remove:function(t,i){var r=this;r.objectItems&&(t=typeof t=="object"?n.grep(r.itemsArray,function(n){return r.options.itemValue(n)==r.options.itemValue(t)})[0]:n.grep(r.itemsArray,function(n){return r.options.itemValue(n)==t})[0]);t&&(n(".tag",r.$container).filter(function(){return n(this).data("item")===t}).remove(),n("option",r.$element).filter(function(){return n(this).data("item")===t}).remove(),r.itemsArray.splice(n.inArray(t,r.itemsArray),1));i||r.pushVal();r.options.maxTags>r.itemsArray.length&&r.$container.removeClass("bootstrap-tagsinput-max");r.$element.trigger(n.Event("itemRemoved",{item:t}))},removeAll:function(){var t=this;for(n(".tag",t.$container).remove(),n("option",t.$element).remove();t.itemsArray.length>0;)t.itemsArray.pop();t.pushVal();t.options.maxTags&&!this.isEnabled()&&this.enable()},refresh:function(){var i=this;n(".tag",i.$container).each(function(){var r=n(this),u=r.data("item"),e=i.options.itemValue(u),o=i.options.itemText(u),s=i.options.tagClass(u),f;r.attr("class",null);r.addClass("tag "+t(s));r.contents().filter(function(){return this.nodeType==3})[0].nodeValue=t(o);i.isSelect&&(f=n("option",i.$element).filter(function(){return n(this).data("item")===u}),f.attr("value",e))})},items:function(){return this.itemsArray},pushVal:function(){var t=this,i=n.map(t.items(),function(n){return t.options.itemValue(n).toString()});t.$element.val(i,!0).trigger("change")},build:function(t){var i=this,e;i.options=n.extend({},f,t);e=i.options.typeahead||{};i.objectItems&&(i.options.freeInput=!1);r(i.options,"itemValue");r(i.options,"itemText");r(i.options,"tagClass");i.options.source&&(e.source=i.options.source);e.source&&n.fn.typeahead&&(o(e,"source"),i.$input.typeahead({source:function(t,r){function f(n){for(var u,f=[],t=0;t<n.length;t++)u=i.options.itemText(n[t]),o[u]=n[t],f.push(u);r(f)}this.map={};var o=this.map,u=e.source(t);n.isFunction(u.success)?u.success(f):n.when(u).then(f)},updater:function(n){i.add(this.map[n])},matcher:function(n){return n.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1},sorter:function(n){return n.sort()},highlighter:function(n){var t=new RegExp("("+this.query+")","gi");return n.replace(t,"<strong>$1<\/strong>")}}));i.$container.on("click",n.proxy(function(){i.$input.focus()},i));i.$container.on("keydown","input",n.proxy(function(t){var r=n(t.target),f=i.findInputWrapper(),e,o,s,h;switch(t.which){case 8:u(r[0])===0&&(e=f.prev(),e&&i.remove(e.data("item")));break;case 46:u(r[0])===0&&(o=f.next(),o&&i.remove(o.data("item")));break;case 37:s=f.prev();r.val().length===0&&s[0]&&(s.before(f),r.focus());break;case 39:h=f.next();r.val().length===0&&h[0]&&(h.after(f),r.focus());break;default:i.options.freeInput&&n.inArray(t.which,i.options.confirmKeys)>=0&&(i.add(r.val()),r.val(""),t.preventDefault())}r.attr("size",Math.max(this.inputSize,r.val().length))},i));i.$container.on("click","[data-role=remove]",n.proxy(function(t){i.remove(n(t.target).closest(".tag").data("item"))},i));i.options.itemValue===f.itemValue&&(i.$element[0].tagName==="INPUT"?i.add(i.$element.val()):n("option",i.$element).each(function(){i.add(n(this).attr("value"),!0)}))},destroy:function(){var n=this;n.$container.off("keypress","input");n.$container.off("click","[role=remove]");n.$container.remove();n.$element.removeData("tagsinput");n.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],i=this.$container[0];t&&t.parentNode!==i;)t=t.parentNode;return n(t)}};n.fn.tagsinput=function(t,r){var u=[];return this.each(function(){var f=n(this).data("tagsinput"),e;f?(e=f[t](r),e!==undefined&&u.push(e)):(f=new i(this,t),n(this).data("tagsinput",f),u.push(f),this.tagName==="SELECT"&&n("option",n(this)).attr("selected","selected"),n(this).val(n(this).val()))}),typeof t=="string"?u.length>1?u:u[0]:u};n.fn.tagsinput.Constructor=i;e=n("<div />");n(function(){n("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);